# Server-specific configuration with database credentials
# Completely independent from worker config - no shared ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: noetl-server-config
  namespace: noetl
  labels:
    app: noetl-server
data:
  # Timezone - Must match Postgres timezone for correct timestamp handling
  TZ: "UTC"
  LOG_LEVEL: "INFO"
  PYTHONPATH: "/opt/noetl"
  NOETL_RUN_MODE: "server"
  NOETL_DATA_DIR: "/opt/noetl/data"
  NOETL_DEBUG: "true"
  NOETL_HTTP_MOCK_LOCAL: "false"
  PAGINATION_API_URL: "http://paginated-api.test-server.svc.cluster.local:5555"
  NOETL_SERVER_URL: "http://noetl.noetl.svc.cluster.local:8082"
  NOETL_DISABLE_METRICS: "true"
  NOETL_VICTORIALOGS_URL: "http://vmlogs-single-server.vmlogs.svc.cluster.local:9428"
  NOETL_LOG_FORMAT: ""
  # NATS Configuration for command publishing
  NATS_URL: "nats://noetl:noetl@nats.nats.svc.cluster.local:4222"
  NATS_USER: "noetl"
  NATS_PASSWORD: "noetl"
  NATS_STREAM: "NOETL_COMMANDS"
  NATS_CONSUMER: "noetl_worker_pool"
  NATS_SUBJECT: "noetl.commands"
  # Keychain cache refresh threshold (15 minutes - prevents expiration during long loops)
  NOETL_KEYCHAIN_REFRESH_THRESHOLD: "900"
  # Server Runtime Configuration
  NOETL_ENABLE_UI: "true"
  NOETL_HOST: "0.0.0.0"
  NOETL_PORT: "8082"
  NOETL_SERVER_NAME: "server-k8s"
  NOETL_SERVER: "uvicorn"
  NOETL_SERVER_WORKERS: "1"
  NOETL_SERVER_RELOAD: "false"
  NOETL_AUTO_RECREATE_RUNTIME: "true"
  NOETL_HEARTBEAT_RETRY_AFTER: "3"
  NOETL_RUNTIME_SWEEP_INTERVAL: "15"
  NOETL_RUNTIME_OFFLINE_SECONDS: "60"
  NOETL_SERVER_METRICS_INTERVAL: "60"
  # Database Configuration (SERVER ONLY - not accessible to workers)
  # Note: POSTGRES_USER/POSTGRES_DB removed - those are application-level and defined in playbook credentials
  POSTGRES_HOST: "postgres.postgres.svc.cluster.local"
  POSTGRES_PORT: "5432"
  NOETL_POSTGRES_DB: "noetl"
  NOETL_USER: "noetl"
  NOETL_SCHEMA: "noetl"
  NOETL_DB_STARTUP_TIMEOUT: "180"
  NOETL_DB_RETRY_INTERVAL: "5"
