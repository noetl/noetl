apiVersion: noetl.io/v2
kind: Playbook
metadata:
  name: test_args_passing
  path: tests/test_args_passing

workload:
  initial_value: 100

workflow:
  - step: start
    desc: Start workflow
    tool:
      kind: python
      code: |
        def main():
            return {"status": "initialized"}
    
    case:
      - when: "{{ event.name == 'step.exit' }}"
        then:
          next:
            - step: use_vars
              args:
                test_var: "{{ workload.initial_value }}"
                computed: 200

  - step: use_vars
    desc: Test that variables from data block are available
    tool:
      kind: python
      code: |
        def main():
            # These should be available from the data block in next
            test_var = {{ test_var }}
            computed = {{ computed }}
            result = test_var + computed
            print(f"test_var={test_var}, computed={computed}, result={result}")
            assert test_var == 100, f"Expected test_var=100, got {test_var}"
            assert computed == 200, f"Expected computed=200, got {computed}"
            assert result == 300, f"Expected result=300, got {result}"
            return {"status": "success", "result": result}
    
    case:
      - when: "{{ event.name == 'step.exit' and response is defined }}"
        then:
          next:
            - step: end

  - step: end
    desc: End workflow
    tool:
      kind: python
      code: |
        def main():
            return {"status": "complete"}
