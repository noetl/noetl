apiVersion: noetl.io/v2
kind: Playbook

metadata:
  name: broken_sql
  path: tests/fixtures/playbooks/broken_sql

workload:
  pg_auth: pg_local

workflow:
  - step: start
    desc: Start data transfer pipeline
    tool:
      kind: python
      code: |
            return {"status": "initialized"}
    next:
      spec:
        mode: exclusive
      arcs:
        - step: verify_pg_data
  - step: verify_pg_data
    desc: Verify data was transferred to PostgreSQL
    tool:
      kind: postgres
      auth: "{{ pg_auth }}"
      command: |
        SELECT
          COUNT(*) as row_count,
        FROM patient_info;
    next:
      spec:
        mode: exclusive
      arcs:
        - step: end
  - step: end
    desc: End data transfer test pipeline
    tool:
      kind: python
      code: |
            return {"status": "completed"}
