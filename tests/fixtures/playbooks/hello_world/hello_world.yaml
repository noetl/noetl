apiVersion: noetl.io/v1
kind: Playbook

metadata:
  name: hello_world
  path: tests/fixtures/playbooks/hello_world

workload:
  message: "Hello World"

workflow:
  - step: start
    desc: "Start hello world test"
    next:
      - step: test_step
        args:
          message: "{{ workload.message }}"

  - step: test_step
    desc: "Hello world test step"
    tool: python
    args:
      message: "{{ workload.message }}"
    code: |
      async def main(message):
          print(f"HELLO_WORLD: {message}")
          # Required envelope: {status, data, meta?}
          return {"status": "success", "data": {"message": message}}
    next:
      - step: end

  - step: end
    desc: "End hello world test"
    tool: end
  sink:
      tool: event_log
      args:
        status: "success"
        message: "{{ test_step.result.data.message }}"
