apiVersion: noetl.io/v10
kind: Playbook
metadata:
  name: simple_http_example_v2
  path: examples/simple_http_v2
  labels:
    category: example
    version: v10

workload:
  api_url: "https://httpbin.org"
  endpoints:
    - path: "/get"
      name: "test_get"

workflow:
  - step: start
    desc: "Start workflow"
    tool:
      kind: http
      spec:
        method: GET
        url: "{{ api_url }}/get"
        params:
          test: "hello"
        policy:
          rules:
            - when: "{{ outcome.status == 'error' and outcome.error.retryable }}"
              then:
                do: retry
                attempts: 3
                backoff: exponential
                delay: 0.5
            - when: "{{ outcome.status == 'error' }}"
              then:
                do: fail
            - else:
                do: continue
    next:
      spec:
        mode: exclusive
      arcs:
        - step: process
          args:
            data: "{{ start.data }}"

  - step: process
    desc: "Process HTTP response"
    tool:
      kind: python
      spec:
        args:
          data: "{{ data }}"
        code: |
          print(f"Processing data: {data}")
          result = {"status": "processed", "data": data}
    next:
      spec:
        mode: exclusive
      arcs:
        - step: end

  - step: end
    desc: "End workflow"
    tool:
      kind: python
      spec:
        args: {}
        code: |
          print("Workflow complete")
          result = {"status": "done"}
