apiVersion: noetl.io/v2
kind: Playbook
metadata:
  name: test_start_with_action
  path: tests/control-flow/start_with_action
  description: Test start step with action type that executes then routes

workload:
  test_value: "hello"
  
workflow:
  - step: start
    desc: Start step with Python action - should execute first
    tool:
      kind: python
      auth: {}
      libs: {}
      args:
        input_data: "{{ workload }}"
      code: |
        result = {
            'status': 'success',
            'message': 'Start step executed with action type',
            'data': {'executed': True, 'input': input_data}
        }
    
    case:
      - when: "{{ event.name == 'step.exit' and response is defined }}"
        then:
          result:
            from: response
          next:
            - step: process
              args:
                from_start: "{{ response.data.executed }}"
  
  - step: process
    desc: Process step - executed after start
    tool:
      kind: python
      auth: {}
      libs: {}
      args:
        from_start: "{{ start.data.executed }}"
      code: |
        result = {
            'status': 'success',
            'message': 'Process step executed',
            'data': {
                'from_start': from_start,
                'processed': True
            }
        }
    
    case:
      - when: "{{ event.name == 'step.exit' and response is defined }}"
        then:
          result:
            from: response
          next:
            - step: end
        
  - step: end
    desc: End step - aggregator (no action type)
    tool:
      kind: python
      auth: {}
      libs: {}
      args: {}
      code: |
        result = {"status": "complete"}
