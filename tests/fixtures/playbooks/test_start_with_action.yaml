apiVersion: noetl.io/v2
kind: Playbook
metadata:
  name: test_start_with_action
  path: tests/control-flow/start_with_action
  description: Test start step with action type that executes then routes

workload:
  test_value: "hello"

workflow:
  - step: start
    desc: Start step with Python action - should execute first
    tool:
      - init_action:
          kind: python
          args:
            input_data: "{{ workload }}"
          code: |
            result = {
                'status': 'success',
                'message': 'Start step executed with action type',
                'data': {'executed': True, 'input': input_data}
            }
    next:
      - step: process
        args:
          from_start: "{{ start.data.executed }}"

  - step: process
    desc: Process step - executed after start
    tool:
      - process_action:
          kind: python
          args:
            from_start: "{{ args.from_start | default(start.data.executed) }}"
          code: |
            result = {
                'status': 'success',
                'message': 'Process step executed',
                'data': {
                    'from_start': from_start,
                    'processed': True
                }
            }
    next:
      - step: end

  - step: end
    desc: End step - aggregator (no action type)
    tool:
      - complete:
          kind: python
          code: |
            result = {"status": "complete"}
