{
	"id": "/templates/demo",
	"workflow": {
		"version": "1",
		"id": "sample-demo",
		"description": "Retrieves BTC/USD exchange rate from 3 different exchanges, calculates an average and puts the latter into db.",
		"context": {
			"aws": {
				"access-key": "sdFASDFA",
				"secret-key": "ASDASDFASDF"
			}
		},
		"tasks": {
			"retrieve-btc-usd": {
				"description": "Retrieves BTC/USD exchange rate from 3 different exchanges",
				"steps": [
					{
						"s3": {
							"action": "directory",
							"path": "s3a://qlake/{{ loop.value | strip('https://') | '/' }}",
							"validate": "empty"
						},
						"context": "aws"
					},
					{
						"s3": {
							"action": "directory",
							"path": "s3a://qlake/{{ loop.value | strip('https://') | '/' }}",
							"validate": "empty"
						},
						"context": "aws"
					},
					{
						"rest": {
							"action": "download",
							"url": "{{ .value }}",
							"path": "s3a://qlake/{{ loop.value | strip('https://') | '/' }}"
						},
						"context": "aws"
					}
				],
				"loop": [
					"https://cex.io/api/last_price/BTC/USD",
					"https://api.bitfinex.com/v1/pubticker/btcusd",
					"https://api.hitbtc.com/api/2/public/ticker/BTCUSD"
				]
			},
			"aggregate-btc-usd": {
				"description": "Calculate BTC/USD average and display result",
				"steps": [
					{
						"aggregate": {
							"action": "average",
							"sources": [
								"s3a://qlake/cex.io/api/last_price/BTC/USD/",
								"s3a://qlake/api.bitfinex.com/v1/pubticker/btcusd/",
								"s3a://qlake/api.hitbtc.com/api/2/public/ticker/BTCUSD/"
							]
						},
						"context": "aws"
					}
				],
				"require": [
					"retrieve-btc-usd"
				]
			}
		}
	}
}